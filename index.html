<!DOCTYPE html>

<script>

navigator.mediaDevices.getUserMedia({ video: true, audio: false })
    .then(localMediaStream => {
      if ('srcObject' in video) {
        video.srcObject = localMediaStream;
      } else {
        video.src = window.URL.createObjectURL(localMediaStream);
      }
      video.play();
    })
    .catch(err => {
      console.error(`Not available!!!!`, err);
    });

</script>
<!-- Add this to your HTML -->
<video id="video" width="320" height="240" autoplay></video>
<canvas id="canvas" style="display:none;"></canvas>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Start Dart Game</title>
</head>

<body>
    <h1>Start Dart Game</h1>
    <form id="gameForm" action="start_game.php" method="POST">
        <label for="player1">Player 1:</label>
        <input type="text" id="player1" name="player1" required><br><br>

        <label for="player2">Player 2:</label>
        <input type="text" id="player2" name="player2" required><br><br>

        <button type="submit">Start Game</button>
    </form>

    <hr>

    <h2>Capture Image</h2>
    <button id="captureBtn">Capture Image</button>
    <div id="imageContainer"></div>

    <script>
        document.getElementById("gameForm").addEventListener("submit", function (event) {
            event.preventDefault();

            const player1 = document.getElementById("player1").value;
            const player2 = document.getElementById("player2").value;

            // Send the player data to PHP to start the game
            fetch("start_game.php", {
                method: "POST",
                body: JSON.stringify({ player1, player2 }),
                headers: {
                    "Content-Type": "application/json"
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        alert('Game started successfully! Game ID: ' + data.game_id);
                    } else {
                        alert('Error starting game: ' + data.message);
                    }
                })
                .catch(error => {
                    alert('Error: ' + error);
                });
        });

        // Initialize the camera and capture image functionality
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(function (stream) {
                const video = document.getElementById("video");
                video.srcObject = stream;
            })
            .catch(function (err) {
                console.log("Error accessing camera: " + err);
            });

        // Capture image when the button is clicked
        document.getElementById("captureBtn").addEventListener("click", function () {
            const canvas = document.getElementById("canvas");
            const video = document.getElementById("video");
            const context = canvas.getContext("2d");

            // Draw the current frame of the video to the canvas
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // Get the image data from the canvas
            const imgData = canvas.toDataURL("image/jpeg");

            // Send the captured image to the server
            fetch('capture_image.php', {
                method: 'POST',
                body: JSON.stringify({ image: imgData, player: 'Player 1' }), // Add actual player turn logic here
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        document.getElementById('imageContainer').innerHTML = 'Image captured and saved!';
                    } else {
                        alert('Error capturing image: ' + data.message);
                    }
                })
                .catch(error => alert('Error: ' + error));
        });

    </script>
</body>

</html>